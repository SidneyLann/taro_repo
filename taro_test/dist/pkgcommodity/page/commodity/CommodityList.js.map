{"version":3,"file":"pkgcommodity/page/commodity/CommodityList.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://i_bizz_client/./src/pkgcommodity/page/commodity/CommodityList.tsx?7274","webpack://i_bizz_client/._src_pkgcommodity_page_commodity_CommodityList.tsx"],"sourcesContent":["import _objectSpread from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport React from 'react';\nimport JsUtil from 'tsx/common/JsUtil';\nimport cnst from 'tsx/common/Constant';\nimport per from 'tsx/common/Permissions';\nimport statuses from 'tsx/common/Statuses';\nimport URI from 'tsx/common/URI';\nimport HeadLayout from 'tsx/layout/HeadLayout';\nimport RowLayout from 'tsx/layout/RowLayout';\nimport BrView from 'tsx/view/BrView';\nimport TextLabel from 'tsx/view/TextLabel';\nimport GeneralInput from 'tsx/form/GeneralInput';\nimport CascadeBox from 'tsx/form/CascadeBox';\nimport TaroModal from 'tsx/component/TaroModal';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar CommodityList = /*#__PURE__*/function (_React$Component) {\n  function CommodityList(props) {\n    var _this;\n    _classCallCheck(this, CommodityList);\n    _this = _callSuper(this, CommodityList, [props]);\n    _defineProperty(_this, \"labels0\", {\n      remark: '备注'\n    });\n    _defineProperty(_this, \"labels1\", _objectSpread({}, _this.labels0));\n    _defineProperty(_this, \"labels\", _objectSpread({}, _this.labels1));\n    _defineProperty(_this, \"errors\", {\n      remark: false\n    });\n    _defineProperty(_this, \"params\", void 0);\n    _defineProperty(_this, \"checkedAllList\", void 0);\n    _defineProperty(_this, \"topNavBarTitle\", '商品列表');\n    _defineProperty(_this, \"searchCommodity\", function (_ref) {\n      var _ref$pageNo = _ref.pageNo,\n        pageNo = _ref$pageNo === void 0 ? 1 : _ref$pageNo,\n        _ref$commodityName = _ref.commodityName,\n        commodityName = _ref$commodityName === void 0 ? _this.params.commodityName : _ref$commodityName,\n        _ref$supplierName = _ref.supplierName,\n        supplierName = _ref$supplierName === void 0 ? _this.params.supplierName : _ref$supplierName,\n        _ref$commodityNo = _ref.commodityNo,\n        commodityNo = _ref$commodityNo === void 0 ? _this.params.commodityNo : _ref$commodityNo,\n        _ref$status = _ref.status,\n        status = _ref$status === void 0 ? _this.params.status : _ref$status,\n        _ref$remark = _ref.remark,\n        remark = _ref$remark === void 0 ? _this.params.remark : _ref$remark,\n        _ref$createTime = _ref.createTime,\n        createTime = _ref$createTime === void 0 ? _this.params.createTime : _ref$createTime,\n        _ref$createTime2 = _ref.createTime2,\n        createTime2 = _ref$createTime2 === void 0 ? _this.params.createTime2 : _ref$createTime2;\n      var operatorId = _this.params.operatorId;\n      var supplierId = _this.params.supplierId;\n      if (!operatorId) {\n        //operatorId = cnst.ID_NO;\n      }\n      var params = {\n        operatorId: operatorId,\n        supplierId: supplierId,\n        commodityName: commodityName,\n        supplierName: supplierName,\n        commodityNo: commodityNo,\n        status: status,\n        remark: remark,\n        createTime: JsUtil.appendTime(createTime),\n        createTime2: JsUtil.appendTime(createTime2),\n        pageNo: pageNo\n      };\n      var succ = function succ(result) {\n        if (JsUtil.handleMessage(_this, result)) {\n          var data = result.body;\n          var checkedList = [];\n          data.map(function (item, idx) {\n            checkedList.push(item.id);\n          });\n          _this.checkedAllList = [].concat(checkedList);\n          _this.setState({\n            commodities: data,\n            totalRecords: result.totalRecords\n          });\n        }\n      };\n      var err = function err(result) {\n        JsUtil.handleMessage(_this, result);\n      };\n      var uri = '';\n      if (_this.params.mallType == cnst.MALL_TYPE_G_B2B) {\n        uri = \"/cm/pub/b2b/global/commodity/\";\n        _this.topNavBarTitle = '全国b2b商品列表';\n      } else if (_this.params.mallType == cnst.MALL_TYPE_G_B2C) {\n        uri = \"/cm/pub/b2c/global/commodity/\";\n        _this.topNavBarTitle = '全国b2c商品列表';\n      } else if (_this.params.mallType == cnst.MALL_TYPE_R_B2B) {\n        uri = \"/cm/pub/b2b/region/commodity/\";\n        _this.topNavBarTitle = '地方b2b商品列表';\n      } else if (_this.params.mallType == cnst.MALL_TYPE_R_B2C) {\n        uri = \"/cm/pub/b2c/region/commodity/\";\n        _this.topNavBarTitle = '地方b2c商品列表';\n      }\n      JsUtil.asyncHttpPost(_this, uri + \"search\", JSON.stringify(params), succ, err);\n    });\n    _defineProperty(_this, \"editFunc\", function (event) {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, '请至少选中一项');\n      } else if (checkedList.length > 1) {\n        JsUtil.showMsgBox(_this, '只能选择一条记录');\n      } else {\n        JsUtil.go2Page(URI.COMMODITY_COMMODITY_PUBLISH + '?mallType=' + _this.params.mallType + '&mode=' + cnst.SHOW_MODE_EDIT + '&id=' + checkedList[0] + '&activeStep=' + cnst.MAX_STEP_NUM);\n      }\n    });\n    _defineProperty(_this, \"detailFunc\", function (event) {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, '请至少选中一项');\n      } else if (checkedList.length > 1) {\n        JsUtil.showMsgBox(_this, '只能选择一条记录');\n      } else {\n        JsUtil.go2Page(URI.COMMODITY_COMMODITY_PUBLISH + '?mallType=' + _this.params.mallType + '&mode=' + cnst.SHOW_MODE_VIEW + '&id=' + checkedList[0] + '&activeStep=' + cnst.MAX_STEP_NUM);\n      }\n    });\n    _defineProperty(_this, \"pullOn\", function (event) {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, \"请至少选中一项\");\n        return;\n      }\n      var uri = \"/cm/pub/b2b/global/commodity/pullon/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_G_B2C) uri = \"/cm/pub/b2c/global/commodity/pullon/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2B) uri = \"/cm/pub/b2b/region/commodity/pullon/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2C) uri = \"/cm/pub/b2c/region/commodity/pullon/update\";\n      JsUtil.asyncHttpPost(_this, uri, JSON.stringify(checkedList), function (result) {\n        if (JsUtil.handleMessage(_this, result, true)) {\n          _this.setState({\n            checkedList: []\n          });\n          _this.searchCommodity({});\n        }\n      }, function (err) {\n        return JsUtil.showMsgBox(_this, err.message);\n      });\n    });\n    _defineProperty(_this, \"approvePrepare\", function () {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, \"请至少选中一项\");\n      } else {\n        _this.setState({\n          popupApprove: true\n        });\n      }\n    });\n    _defineProperty(_this, \"approve\", function () {\n      _this.approval(true);\n    });\n    _defineProperty(_this, \"reject\", function () {\n      _this.approval(false);\n    });\n    _defineProperty(_this, \"approval\", function (pass) {\n      var remark = _this.state.remark;\n      if (!pass && !remark) {\n        JsUtil.showMsgBox(_this, '请填写备注');\n        return;\n      }\n      var checkedList = _this.state.checkedList;\n      var succ = function succ(result) {\n        if (JsUtil.handleMessage(_this, result, true)) {\n          _this.setState({\n            checkedList: []\n          });\n          _this.searchCommodity({});\n        }\n      };\n      var err = function err(result) {\n        JsUtil.showMsgBox(_this, '请求失败:' + result.message);\n      };\n      var ids = '';\n      checkedList.map(function (id) {\n        ids = ids + 'ids=' + id + '&';\n      });\n      var uri = \"/cm/pub/b2b/global/commodity/approve/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_G_B2C) uri = \"/cm/pub/b2c/global/commodity/approve/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2B) uri = \"/cm/pub/b2b/region/commodity/approve/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2C) uri = \"/cm/pub/b2c/region/commodity/approve/update\";\n      JsUtil.asyncHttpPost(_this, uri, ids + 'pass=' + pass + '&remark=' + remark, succ, err, \"application/x-www-form-urlencoded\");\n      _this.setState({\n        remark: '',\n        popupApprove: false\n      });\n    });\n    _defineProperty(_this, \"pullofPrepare\", function () {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, \"请至少选中一项\");\n      } else {\n        _this.setState({\n          popuppullOff: true\n        });\n      }\n    });\n    _defineProperty(_this, \"pullOff\", function () {\n      var checkedList = _this.state.checkedList;\n      var remark = _this.state.remark;\n      if (!remark) {\n        JsUtil.showMsgBox(_this, '请填写备注');\n        return;\n      }\n      var succ = function succ(result) {\n        if (JsUtil.handleMessage(_this, result, true)) {\n          _this.setState({\n            checkedList: []\n          });\n          _this.searchCommodity({});\n        }\n      };\n      var err = function err(result) {\n        JsUtil.showMsgBox(_this, '请求失败:' + result.message);\n      };\n      var ids = '';\n      checkedList.map(function (id) {\n        ids = ids + 'ids=' + id + '&';\n      });\n      var uri = \"/cm/pub/b2b/global/commodity/pulloff/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_G_B2C) uri = \"/cm/pub/b2c/global/commodity/pulloff/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2B) uri = \"/cm/pub/b2b/region/commodity/pulloff/update\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2C) uri = \"/cm/pub/b2c/region/commodity/pulloff/update\";\n      JsUtil.asyncHttpPost(_this, uri + '?' + ids + '&remark=' + remark, null, succ, err, cnst.REQUEST_TYPE_WWW);\n      _this.setState({\n        remark: '',\n        popuppullOff: false\n      });\n    });\n    _defineProperty(_this, \"remove\", function () {\n      var checkedList = _this.state.checkedList;\n      if (checkedList.length == 0) {\n        JsUtil.showMsgBox(_this, '请至少选中一项');\n        return;\n      }\n      var uri = \"/cm/pub/b2b/global/commodity/delete\";\n      if (_this.params.mallType == cnst.MALL_TYPE_G_B2C) uri = \"/cm/pub/b2c/global/commodity/delete\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2B) uri = \"/cm/pub/b2b/region/commodity/delete\";\n      if (_this.params.mallType == cnst.MALL_TYPE_R_B2C) uri = \"/cm/pub/b2c/region/commodity/delete\";\n      var succ = function succ(result) {\n        if (JsUtil.handleMessage(_this, result, true)) {\n          _this.setState({\n            checkedList: []\n          });\n          _this.searchCommodity({});\n        }\n      };\n      var err = function err(result) {\n        JsUtil.handleMessage(_this, result, true);\n      };\n      JsUtil.asyncHttpPost(_this, uri, JSON.stringify(checkedList), succ, err);\n    });\n    _defineProperty(_this, \"getListOptions\", function (records) {\n      var options = [];\n      records.map(function (item, indx) {\n        var desc = /*#__PURE__*/_jsxs(RowLayout, {\n          justifyContent: \"space-around\",\n          width: cnst.NUM_WIDTH_MAIN + 3,\n          children: [/*#__PURE__*/_jsx(TextLabel, {\n            color: \"red\",\n            children: JsUtil.currFormat(item.price)\n          }), /*#__PURE__*/_jsx(TextLabel, {\n            children: item.supplierName\n          }), /*#__PURE__*/_jsx(TextLabel, {\n            children: statuses.cmdLabel(item.status)\n          })]\n        });\n        options.push({\n          value: item.id,\n          label: /*#__PURE__*/_jsx(TextLabel, {\n            children: item.commodityName\n          }),\n          desc: desc\n        });\n      });\n      return options;\n    });\n    _defineProperty(_this, \"onCheckBoxesAllChanged\", function (name, selectedValues) {\n      if (selectedValues.length == 0) {\n        _this.setState(_defineProperty({}, name, []));\n      } else {\n        _this.setState(_defineProperty({}, name, _this.checkedAllList));\n      }\n    });\n    _defineProperty(_this, \"onCascadeBoxChanged\", function (name, selectedValues) {\n      _this.setState(_defineProperty({}, name, selectedValues));\n    });\n    _defineProperty(_this, \"onInputChanged\", function (name, value) {\n      _this.setState(_defineProperty({}, name, value));\n    });\n    _defineProperty(_this, \"onClose\", function (name) {\n      _this.setState(_defineProperty({}, name, false));\n    });\n    _defineProperty(_this, \"onConfirm\", function () {\n      JsUtil.closeMsgBox(_this);\n    });\n    _this.params = JsUtil.getUrlParams(_this);\n    _this.state = {\n      commodities: [],\n      commodityName: '',\n      createTime2: ' ',\n      commodityNo: '',\n      supplierName: '',\n      createTime: ' ',\n      remark: '',\n      image: '',\n      ids: '',\n      page: 1,\n      rowsPerPage: cnst.PAGE_SIZE,\n      totalRecords: 0,\n      checkedList: []\n    };\n    return _this;\n  }\n  _inherits(CommodityList, _React$Component);\n  return _createClass(CommodityList, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.searchCommodity({});\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      var _this$state = this.state,\n        commodities = _this$state.commodities,\n        totalRecords = _this$state.totalRecords,\n        rowsPerPage = _this$state.rowsPerPage,\n        currentStatus = _this$state.currentStatus,\n        checkedList = _this$state.checkedList;\n      var show = {\n        edit: false,\n        pullOn: false,\n        approve: false,\n        pullOff: false,\n        remove: false\n      };\n      if (per.hasRole(per.authorities.HQ_BASIC) || per.hasRole(per.authorities.OP_BASIC)) {\n        show.approve = true;\n        show.pullOff = true;\n      } else if (per.hasRole(per.authorities.SP_BASIC_R) || per.hasRole(per.authorities.SP_BASIC_G)) {\n        show.edit = true;\n        show.pullOn = true;\n        show.pullOff = true;\n        show.remove = true;\n      }\n      var options = this.getListOptions(commodities);\n      var commandLabel3 = show.remove ? '删除' : '';\n      var commandLabel4 = show.edit ? '编辑' : '';\n      var commandLabel5 = show.pullOn ? '上架' : '';\n      var commandLabel6 = show.pullOff ? '下架' : '';\n      var commandLabel7 = show.approve ? '审批' : '';\n      var command4 = this.editFunc;\n      return /*#__PURE__*/_jsxs(HeadLayout, {\n        that: this,\n        topNavBarTitle: this.topNavBarTitle,\n        bottomLabel1: '全选',\n        bottomFunc1: this.onCheckBoxesAllChanged,\n        bottomLabel2: '明细',\n        bottomFunc2: this.detailFunc,\n        bottomLabel3: commandLabel3,\n        bottomFunc3: this.remove,\n        bottomLabel4: commandLabel4,\n        bottomFunc4: command4,\n        bottomLabel5: commandLabel5,\n        bottomFunc5: this.pullOn,\n        bottomLabel6: commandLabel6,\n        bottomFunc6: this.pullofPrepare,\n        bottomLabel7: commandLabel7,\n        bottomFunc7: this.approvePrepare,\n        children: [/*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_NEAR_WHITE\n        }), /*#__PURE__*/_jsx(CascadeBox, {\n          name: \"checkedList\",\n          options: options,\n          value: checkedList,\n          onChange: this.onCascadeBoxChanged\n        }), /*#__PURE__*/_jsx(TaroModal, {\n          isOpened: this.state.popupApprove,\n          onClose: function onClose(e) {\n            return _this2.onClose('popupApprove', e);\n          },\n          onConfirm: this.approve,\n          onCancel: this.reject,\n          confirmText: \"\\u901A\\u8FC7\",\n          cancelText: \"\\u62D2\\u7EDD\",\n          children: /*#__PURE__*/_jsx(GeneralInput, {\n            name: 'remark',\n            label: this.labels.remark,\n            type: 'text',\n            value: this.state.remark,\n            error: this.errors.remark,\n            onChange: this.onInputChanged\n          })\n        }), /*#__PURE__*/_jsx(TaroModal, {\n          isOpened: this.state.popuppullOff,\n          onClose: function onClose(e) {\n            return _this2.onClose('popuppullOff', e);\n          },\n          onConfirm: this.pullOff,\n          confirmText: \"\\u786E\\u5B9A\",\n          children: /*#__PURE__*/_jsx(GeneralInput, {\n            name: 'remark',\n            label: this.labels.remark,\n            type: 'text',\n            value: this.state.remark,\n            error: this.errors.remark,\n            onChange: this.onInputChanged\n          })\n        })]\n      });\n    }\n  }]);\n}(React.Component);\nexport default CommodityList;","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pkgcommodity/page/commodity/CommodityList!./CommodityList.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pkgcommodity/page/commodity/CommodityList', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}