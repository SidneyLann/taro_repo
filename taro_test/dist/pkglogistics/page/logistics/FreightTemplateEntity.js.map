{"version":3,"file":"pkglogistics/page/logistics/FreightTemplateEntity.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxqBA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAuCA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAMA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAGA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AACA;AAxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAyDA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAAA;AAAA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3IA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AAyCA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAPA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAEA;AAIA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAEA;AAGA;AAAA;AAEA;AACA;AAEA;AAEA;AAAA;AAEA;AAAA;AAEA;AAAA;AAGA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA;AAAA;AAAA;AAAA;AACA;AAjTA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAoQA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAGA;;;;;;;;;;;;;ACvUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://i_bizz_client/./src/pkglogistics/page/logistics/FreightTemplateEntity.tsx?5f82","webpack://i_bizz_client/._src_component_RegionField3.tsx","webpack://i_bizz_client/._src_component_RegionTree.tsx","webpack://i_bizz_client/._src_pkglogistics_page_logistics_FreightTemplateEntity.tsx"],"sourcesContent":["import _createForOfIteratorHelper from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _toConsumableArray from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"c:/taro/i_bizz_client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport React from 'react';\nimport validator from 'validator';\nimport JsUtil from 'tsx/common/JsUtil';\nimport cnst from 'tsx/common/Constant';\nimport HeadLayout from 'tsx/layout/HeadLayout';\nimport RowLayout from 'tsx/layout/RowLayout';\nimport BrView from 'tsx/view/BrView';\nimport Level2View from 'tsx/view/Level2View';\nimport TextLabel from 'tsx/view/TextLabel';\nimport SelectInput from 'tsx/form/SelectInput';\nimport TaroModal from 'tsx/component/TaroModal';\nimport RegionField3 from 'tsx/component/RegionField3';\nimport GeneralButton from 'tsx/form/GeneralButton';\nimport GeneralInput from 'tsx/form/GeneralInput';\nimport RegionTree from 'tsx/component/RegionTree';\nimport OperatorSelect from 'tsx/component/OperatorSelect';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar FreightTemplateEntity = /*#__PURE__*/function (_React$Component) {\n  function FreightTemplateEntity(props) {\n    var _this;\n    _classCallCheck(this, FreightTemplateEntity);\n    _this = _callSuper(this, FreightTemplateEntity, [props]);\n    _defineProperty(_this, \"labels0\", {\n      templateName: '模板名称',\n      pricingMethod: '计价方式',\n      promiseTime: '发货时间',\n      operatorId: '运营中心',\n      shippingMethod: '运输方式',\n      startQuantity: '首单位',\n      startPrice: '首费',\n      stepQuantity: '续单位',\n      stepPrice: '续费',\n      startKm: '首Km',\n      startKmPrice: '首费2',\n      stepKm: '续Km',\n      stepKmPrice: '续费2',\n      regionId: '地区编号',\n      regionLevel: '地区级别'\n    });\n    _defineProperty(_this, \"labels1\", _objectSpread({}, _this.labels0));\n    _defineProperty(_this, \"labels\", _objectSpread({}, _this.labels1));\n    _defineProperty(_this, \"validateFields\", void 0);\n    _defineProperty(_this, \"validateForm\", void 0);\n    _defineProperty(_this, \"params\", void 0);\n    _defineProperty(_this, \"isRegionMall\", void 0);\n    _defineProperty(_this, \"opOptionType\", void 0);\n    _defineProperty(_this, \"regionNodes\", []);\n    _defineProperty(_this, \"currentFreightIdx\", -1);\n    _defineProperty(_this, \"supplierId\", JsUtil.getAppItem('currOrgId'));\n    _defineProperty(_this, \"onInputChanged\", function (name, value) {\n      if (_this.state.mode != cnst.SHOW_MODE_LIST) _this.validateFields(_this, validator, name, value);\n      _this.setState(_defineProperty({}, name, value));\n    });\n    _defineProperty(_this, \"freightValueChanged\", function (name, value) {\n      var ids = name.split('-');\n      var index = parseInt(ids[1]);\n      var fieldName = ids[0];\n      if (value.endsWith('.')) return;\n      var value2 = '';\n      if (_this.state.pricingMethod = cnst.PRICING_METHOD_PRICE) {\n        if (fieldName.indexOf('Quantity') != -1) {\n          value2 = parseInt(value);\n        } else {\n          value2 = parseFloat(value);\n        }\n      } else {\n        value2 = parseFloat(value);\n      }\n      if (isNaN(value2)) value2 = '';\n      _this.setState(function (pre) {\n        var freightDetails = pre.freightDetails;\n        freightDetails[index] = _objectSpread(_objectSpread({}, freightDetails[index]), {}, _defineProperty({}, fieldName, value2));\n        return {\n          freightDetails: _toConsumableArray(freightDetails)\n        };\n      });\n    });\n    _defineProperty(_this, \"submit\", function () {\n      var templateName = _this.state.templateName;\n      var promiseTime = _this.state.promiseTime;\n      var freightDetails = _this.state.freightDetails;\n      var groupNo = -1;\n      var qtyPriceMsg = '';\n      freightDetails.forEach(function (item, idx) {\n        if (item.freightDetailRegions.length == 0) {\n          groupNo = idx;\n        }\n        if (item.startQuantity === '' || item.startPrice === '' || item.stepQuantity === '' || item.stepPrice === '') qtyPriceMsg = '第' + (idx + 1) + '组运费模板的数量或价格没有设置';\n      });\n      if (groupNo >= 0) {\n        JsUtil.showMsgBox(_this, '第' + (groupNo + 1) + '组运费模板的地区没有设置');\n        return;\n      }\n      if (qtyPriceMsg) {\n        JsUtil.showMsgBox(_this, qtyPriceMsg);\n        return;\n      }\n      var param = {};\n      if (_this.state.mode == cnst.SHOW_MODE_NEW) {\n        param = {\n          freightDetails: freightDetails,\n          promiseTime: promiseTime,\n          templateName: templateName,\n          pricingMethod: _this.state.pricingMethod,\n          shippingMethod: _this.state.shippingMethod,\n          operatorId: _this.state.operatorId,\n          supplierId: _this.supplierId,\n          mallType: _this.params.mallType\n        };\n      } else if (_this.state.mode == cnst.SHOW_MODE_EDIT) {\n        param = _objectSpread(_objectSpread({}, _this.state.entity), {}, {\n          freightDetails: freightDetails,\n          promiseTime: promiseTime,\n          templateName: templateName,\n          pricingMethod: _this.state.pricingMethod\n        });\n      }\n      var msgs = _this.validateForm(validator, _this.labels0, param);\n      if (msgs != '') {\n        JsUtil.showMsgBox(_this, msgs);\n        return;\n      }\n      var succ = function succ(result) {\n        if (JsUtil.handleMessage(_this, result, true)) {}\n      };\n      var err = function err(result) {\n        JsUtil.handleMessage(_this, result, true);\n      };\n      JsUtil.asyncHttpPost(_this, \"/lg/pub/freight/template/\".concat(_this.state.mode == cnst.SHOW_MODE_EDIT ? 'update' : 'create'), JSON.stringify(param), succ, err);\n    });\n    _defineProperty(_this, \"onEdit\", function (index, operatorId) {\n      if (!_this.state.initFinish) {\n        JsUtil.showMsgBox(_this, '请稍等，地区数据正在加载');\n        return;\n      }\n      if (!operatorId) {\n        JsUtil.showMsgBox(_this, '请选择运营中心');\n        return;\n      }\n      _this.currentFreightIdx = index;\n      _this.setState({\n        openRegion: true\n      });\n    });\n    _defineProperty(_this, \"cancelRegionDialog\", function () {\n      _this.setState({\n        openRegion: false\n      });\n      _this.currentFreightIdx = -1;\n    });\n    _defineProperty(_this, \"confirmRegionDialog\", function () {\n      var regionId = _this.state.regionId;\n      if (!regionId) return;\n      var freightIdx = _this.currentFreightIdx;\n      _this.setState({\n        openRegion: false\n      });\n      var freightDetailRegions = _this.getFreightDetailRegions(_this.regionNodes, regionId);\n      if (freightDetailRegions.length == 0) return;\n      _this.setState(function (pre) {\n        var freightDetails = pre.freightDetails;\n        freightDetails[freightIdx].freightDetailRegions = freightDetailRegions;\n        return {\n          freightDetails: _toConsumableArray(freightDetails)\n        };\n      });\n      _this.currentFreightIdx = -1;\n    });\n    _defineProperty(_this, \"getFreightDetailRegions\", function (regionNodes, regionId) {\n      var freightDetailRegions = [];\n      var _iterator = _createForOfIteratorHelper(regionNodes),\n        _step;\n      try {\n        var _loop = function _loop() {\n          var node = _step.value;\n          if (node.checked) {\n            var regionFullName = \"\".concat(node.name);\n            if (node.pid != regionId) {\n              var parentNode = regionNodes.find(function (e) {\n                return e.id == node.pid;\n              });\n              if (parentNode) {\n                regionFullName = parentNode.name + regionFullName;\n                if (parentNode.pid != regionId) {\n                  var topNode = regionNodes.find(function (e) {\n                    return e.id == parentNode.pid;\n                  });\n                  if (topNode) {\n                    regionFullName = topNode.name + regionFullName;\n                  }\n                }\n              }\n            }\n            freightDetailRegions = [].concat(_toConsumableArray(freightDetailRegions), [{\n              regionId: node.id,\n              regionFullName: regionFullName,\n              recordLevel: node.recordLevel\n            }]);\n          }\n        };\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          _loop();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return freightDetailRegions;\n    });\n    _defineProperty(_this, \"changeHandler\", function (name) {\n      return function (item) {\n        var value = item.value;\n        _this.setState(_defineProperty({}, name, value));\n      };\n    });\n    _defineProperty(_this, \"onCheckLevelAll\", function () {\n      _this.setState({\n        checkLevelAll: !_this.state.checkLevelAll\n      });\n    });\n    _defineProperty(_this, \"onInitFinish\", function (value) {\n      _this.setState({\n        initFinish: value\n      });\n    });\n    _defineProperty(_this, \"setNodes\", function (nodes) {\n      _this.regionNodes = nodes;\n    });\n    _defineProperty(_this, \"onConfirm\", function () {\n      JsUtil.closeMsgBox(_this);\n    });\n    _this.params = JsUtil.getUrlParams(_this);\n    _this.isRegionMall = _this.params.mallType == cnst.MALL_TYPE_R_B2C;\n    _this.opOptionType = _this.params.mallType == cnst.MALL_TYPE_R_B2C ? cnst.OP_OPTION_TYPE_SUPPLIER : '';\n    _this.state = {\n      mode: _this.params.mode || cnst.SHOW_MODE_NEW,\n      entity: {},\n      operatorOptions: [],\n      operatorId: cnst.ID_HQ,\n      openRegion: false,\n      regionId: cnst.ID_TOP_REGION,\n      templateName: '',\n      pricingMethodOptions: [{\n        value: cnst.PRICING_METHOD_PRICE,\n        label: '按件数'\n      }, {\n        value: cnst.PRICING_METHOD_WEIGHT,\n        label: '按重量'\n      }, {\n        value: cnst.PRICING_METHOD_MONEY_AMOUNT,\n        label: '按金额'\n      }],\n      pricingMethod: cnst.PRICING_METHOD_PRICE,\n      promiseTimeOptions: [{\n        value: 1,\n        label: '一小时以内'\n      }, {\n        value: 6,\n        label: '六小时以内'\n      }, {\n        value: 12,\n        label: '十二小时内'\n      }, {\n        value: 18,\n        label: '十八小时内'\n      }, {\n        value: 24,\n        label: '二十四小时内'\n      }, {\n        value: 48,\n        label: '四十八小时内'\n      }, {\n        value: 72,\n        label: '七十二小时内'\n      }],\n      promiseTime: 1,\n      shippingMethod: 1,\n      startPrice: '',\n      startQuantity: '',\n      stepPrice: '',\n      stepQuantity: '',\n      regionLevel: '',\n      checkLevelAll: false,\n      disabled: false,\n      initFinish: true,\n      messages: {},\n      errors: {\n        templateName: false,\n        pricingMethod: false,\n        promiseTime: false,\n        operatorId: false,\n        freightDetails: {\n          shippingMethod: false,\n          startQuantity: [],\n          startPrice: [],\n          stepQuantity: [],\n          stepPrice: [],\n          startKm: [],\n          startKmPrice: [],\n          stepKm: [],\n          stepKmPrice: [],\n          freightDetailRegions: {\n            regionId: false,\n            regionLevel: false\n          }\n        }\n      },\n      freightDetails: [{\n        startQuantity: 1,\n        startPrice: 0,\n        stepQuantity: 1,\n        stepPrice: 0,\n        startKm: 1,\n        startKmPrice: 0,\n        stepKm: 1,\n        stepKmPrice: 0,\n        freightDetailRegions: []\n      }]\n    };\n    return _this;\n  }\n  _inherits(FreightTemplateEntity, _React$Component);\n  return _createClass(FreightTemplateEntity, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n      var mode = this.state.mode;\n      JsUtil.init(this, '/lg/pub/freight/template/init/search', 'freightTemplate').then(function (_ref) {\n        var validateFields = _ref.validateFields,\n          validateForm = _ref.validateForm;\n        _this2.validateFields = validateFields;\n        _this2.validateForm = validateForm;\n      });\n      if (mode == cnst.SHOW_MODE_VIEW || mode == cnst.SHOW_MODE_EDIT) {\n        var id = this.params.id;\n        var succ = function succ(result) {\n          if (JsUtil.handleMessage(_this2, result)) {\n            var entity = result.body;\n            _this2.setState(_objectSpread({\n              entity: entity\n            }, entity));\n          }\n        };\n        var err = function err(result) {\n          JsUtil.handleMessage(_this2, result);\n        };\n        JsUtil.asyncHttpGet(this, \"/lg/pub/freight/template/load/search?id=\".concat(id), succ, err);\n      }\n      if (mode == cnst.SHOW_MODE_VIEW) {\n        this.setState({\n          disabled: true\n        });\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState, snapshot) {\n      var _this3 = this;\n      var _this$state = this.state,\n        pricingMethod = _this$state.pricingMethod,\n        operatorId = _this$state.operatorId;\n      if (!this.state.regionId && this.params.mallType != cnst.MALL_TYPE_R_B2C) {\n        this.setState({\n          regionId: cnst.ID_TOP_REGION\n        });\n        return;\n      }\n      if (operatorId != prevState.operatorId) {\n        var regionId = JsUtil.getAppItem('regionId-' + operatorId);\n        if (regionId) {\n          this.setState({\n            regionId: regionId\n          });\n          return;\n        }\n        var succ = function succ(result) {\n          if (JsUtil.handleMessage(_this3, result)) {\n            var _regionId = result.body;\n            _this3.setState({\n              regionId: _regionId\n            });\n            JsUtil.setAppItem('regionId-' + operatorId, _regionId);\n          }\n        };\n        var err = function err(result) {\n          JsUtil.handleMessage(_this3, result);\n        };\n        JsUtil.asyncHttpGet(this, \"/op/pub/city/region/id/search?operatorId=\".concat(operatorId), succ, err);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n      var _this$state2 = this.state,\n        mode = _this$state2.mode,\n        disabled = _this$state2.disabled,\n        freightDetails = _this$state2.freightDetails,\n        pricingMethodOptions = _this$state2.pricingMethodOptions,\n        pricingMethod = _this$state2.pricingMethod,\n        promiseTimeOptions = _this$state2.promiseTimeOptions,\n        promiseTime = _this$state2.promiseTime,\n        operatorOptions = _this$state2.operatorOptions,\n        operatorId = _this$state2.operatorId;\n      var labelWidth = cnst.NUM_WIDTH_LABEL;\n      var valueWidth = -71;\n      var topNavBarTitle = '运费模板';\n      var commandLabe4 = '提交';\n      var command4 = this.submit;\n      if (this.state.mode == cnst.SHOW_MODE_VIEW) {\n        commandLabe4 = '返回';\n        command4 = JsUtil.goBack;\n      }\n      var labelKey = 'label';\n      var valueKey = 'value';\n      return /*#__PURE__*/_jsxs(HeadLayout, {\n        that: this,\n        topNavBarTitle: topNavBarTitle,\n        bottomLabel4: commandLabe4,\n        bottomFunc4: command4,\n        children: [/*#__PURE__*/_jsx(GeneralInput, {\n          name: 'templateName',\n          label: this.labels.templateName,\n          type: 'text',\n          value: this.state.templateName,\n          error: this.state.errors.templateName,\n          onChange: this.onInputChanged,\n          disabled: disabled,\n          labelWidth: labelWidth,\n          valueWidth: valueWidth\n        }), /*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n        }), this.isRegionMall && /*#__PURE__*/_jsx(OperatorSelect, {\n          mode: mode,\n          optionType: this.opOptionType,\n          checkedId: '',\n          that: this\n        }), this.isRegionMall && /*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n        }), !this.isRegionMall && /*#__PURE__*/_jsx(RegionField3, {\n          mode: mode,\n          that: this,\n          alignItems: \"flex-start\",\n          labelWidth: labelWidth,\n          valueWidth: valueWidth\n        }), !this.isRegionMall && /*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n        }), /*#__PURE__*/_jsx(SelectInput, {\n          options: pricingMethodOptions,\n          labelKey: labelKey,\n          valueKey: valueKey,\n          value: pricingMethod,\n          onChange: this.changeHandler('pricingMethod'),\n          label: this.labels.pricingMethod,\n          disabled: disabled,\n          labelWidth: labelWidth,\n          valueWidth: valueWidth\n        }), /*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n        }), /*#__PURE__*/_jsx(SelectInput, {\n          options: promiseTimeOptions,\n          labelKey: labelKey,\n          valueKey: valueKey,\n          value: promiseTime,\n          onChange: this.changeHandler('promiseTime'),\n          label: this.labels.promiseTime,\n          disabled: disabled,\n          labelWidth: labelWidth,\n          valueWidth: valueWidth\n        }), /*#__PURE__*/_jsx(BrView, {\n          height: cnst.NUM_HEIGHT_LINE,\n          backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n        }), Array.isArray(freightDetails) && freightDetails.map(function (item, freightIdx) {\n          var freightDetailRegions = item.freightDetailRegions;\n          var showData = '';\n          if (Array.isArray(freightDetailRegions)) {\n            var _iterator2 = _createForOfIteratorHelper(freightDetailRegions),\n              _step2;\n            try {\n              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                var region = _step2.value;\n                showData = showData + region.regionFullName + '; ';\n              }\n            } catch (err) {\n              _iterator2.e(err);\n            } finally {\n              _iterator2.f();\n            }\n          }\n          return /*#__PURE__*/_jsxs(Level2View, {\n            children: [/*#__PURE__*/_jsxs(RowLayout, {\n              children: [/*#__PURE__*/_jsx(GeneralInput, {\n                name: 'startQuantity-' + freightIdx,\n                label: _this4.labels.startQuantity,\n                type: 'number',\n                value: item.startQuantity,\n                error: _this4.state.errors.freightDetails.startQuantity[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: -15,\n                valueWidth: -35\n              }), /*#__PURE__*/_jsx(GeneralInput, {\n                name: 'startPrice-' + freightIdx,\n                label: _this4.labels.startPrice,\n                type: 'text',\n                value: item.startPrice,\n                error: _this4.state.errors.freightDetails.startPrice[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: labelWidth + 15,\n                valueWidth: valueWidth + 35\n              })]\n            }), /*#__PURE__*/_jsx(BrView, {\n              height: cnst.NUM_HEIGHT_LINE,\n              backgroundColor: cnst.COLOR_BACKGROUND_WHITE\n            }), /*#__PURE__*/_jsxs(RowLayout, {\n              children: [/*#__PURE__*/_jsx(GeneralInput, {\n                name: 'stepQuantity-' + freightIdx,\n                label: _this4.labels.stepQuantity,\n                type: 'number',\n                value: item.stepQuantity,\n                error: _this4.state.errors.freightDetails.stepQuantity[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: -15,\n                valueWidth: -35\n              }), /*#__PURE__*/_jsx(GeneralInput, {\n                name: 'stepPrice-' + freightIdx,\n                label: _this4.labels.stepPrice,\n                type: 'text',\n                value: item.stepPrice,\n                error: _this4.state.errors.freightDetails.stepPrice[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: labelWidth + 15,\n                valueWidth: valueWidth + 35\n              })]\n            }), (cnst.MALL_TYPE_R_B2B == _this4.params.mallType || cnst.MALL_TYPE_R_B2C == _this4.params.mallType) && /*#__PURE__*/_jsxs(RowLayout, {\n              children: [/*#__PURE__*/_jsx(GeneralInput, {\n                name: 'startKm-' + freightIdx,\n                label: _this4.labels.startKm,\n                type: 'number',\n                value: item.startKm,\n                error: _this4.state.errors.freightDetails.startKm[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: -15,\n                valueWidth: -35\n              }), /*#__PURE__*/_jsx(GeneralInput, {\n                name: 'startKmPrice-' + freightIdx,\n                label: _this4.labels.startKmPrice,\n                type: 'text',\n                value: item.startKmPrice,\n                error: _this4.state.errors.freightDetails.startKmPrice[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: labelWidth + 15,\n                valueWidth: valueWidth + 35\n              })]\n            }), (cnst.MALL_TYPE_R_B2B == _this4.params.mallType || cnst.MALL_TYPE_R_B2C == _this4.params.mallType) && /*#__PURE__*/_jsxs(RowLayout, {\n              children: [/*#__PURE__*/_jsx(GeneralInput, {\n                name: 'stepKm-' + freightIdx,\n                label: _this4.labels.stepKm,\n                type: 'number',\n                value: item.stepKm,\n                error: _this4.state.errors.freightDetails.stepKm[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: -15,\n                valueWidth: -35\n              }), /*#__PURE__*/_jsx(GeneralInput, {\n                name: 'stepKmPrice-' + freightIdx,\n                label: _this4.labels.stepKmPrice,\n                type: 'text',\n                value: item.stepKmPrice,\n                error: _this4.state.errors.freightDetails.stepKmPrice[freightIdx],\n                onChange: _this4.freightValueChanged,\n                disabled: disabled,\n                labelWidth: labelWidth + 15,\n                valueWidth: valueWidth + 35\n              })]\n            }), /*#__PURE__*/_jsx(TextLabel, {\n              color: \"red\",\n              disabled: true,\n              children: showData\n            }), /*#__PURE__*/_jsx(BrView, {\n              height: cnst.NUM_HEIGHT_LINE,\n              backgroundColor: [255, 255, 255, 1]\n            }), _this4.state.mode != cnst.SHOW_MODE_VIEW && /*#__PURE__*/_jsxs(RowLayout, {\n              children: [/*#__PURE__*/_jsx(GeneralButton, {\n                type: \"primary\",\n                size: \"mini\",\n                disabled: disabled,\n                onClick: function onClick() {\n                  return _this4.setState(function (pre) {\n                    var freightDetails = pre.freightDetails;\n                    freightDetails.splice(freightIdx, 1);\n                    return {\n                      freightDetails: _toConsumableArray(freightDetails)\n                    };\n                  });\n                },\n                children: \"\\u5220\\u9664\"\n              }), /*#__PURE__*/_jsx(GeneralButton, {\n                type: \"primary\",\n                size: \"mini\",\n                disabled: disabled,\n                onClick: function onClick() {\n                  return _this4.onEdit(freightIdx, operatorId);\n                },\n                children: \"\\u7F16\\u8F91\"\n              })]\n            }), /*#__PURE__*/_jsx(BrView, {\n              height: cnst.NUM_HEIGHT_LINE,\n              backgroundColor: [255, 255, 255, 1]\n            }), /*#__PURE__*/_jsx(BrView, {\n              height: cnst.NUM_HEIGHT_LINE,\n              backgroundColor: cnst.COLOR_BACKGROUND_TRANS_WHITE\n            })]\n          }, freightIdx);\n        }), /*#__PURE__*/_jsx(BrView, {\n          height: 11,\n          backgroundColor: [255, 255, 255, 1]\n        }), !disabled && /*#__PURE__*/_jsx(GeneralButton, {\n          type: \"primary\",\n          size: \"mini\",\n          width: 66,\n          onClick: function onClick() {\n            return _this4.setState(function (pre) {\n              return {\n                freightDetails: [].concat(_toConsumableArray(pre.freightDetails), [{\n                  startQuantity: 1,\n                  startPrice: 0,\n                  stepQuantity: 1,\n                  stepPrice: 0,\n                  freightDetailRegions: []\n                }])\n              };\n            });\n          },\n          children: \"\\u6DFB\\u52A0\"\n        }), /*#__PURE__*/_jsx(TaroModal, {\n          isOpened: this.state.openRegion,\n          onCancel: this.cancelRegionDialog,\n          onConfirm: this.confirmRegionDialog,\n          onCheckLevelAll: this.onCheckLevelAll,\n          checkText: \"\\u7236\\u9009\",\n          children: /*#__PURE__*/_jsx(RegionTree, {\n            mallType: this.params.mallType,\n            operatorId: operatorId,\n            freightDetails: freightDetails,\n            currentFreightIdx: this.currentFreightIdx,\n            checkLevelAll: this.state.checkLevelAll,\n            setNodes: function setNodes(nodes) {\n              return _this4.setNodes(nodes);\n            },\n            regionId: this.state.regionId,\n            mode: this.state.mode,\n            finishInit: function finishInit(value) {\n              return _this4.onInitFinish(value);\n            }\n          })\n        })]\n      });\n    }\n  }]);\n}(React.Component);\nexport default FreightTemplateEntity;","import React from 'react';\r\nimport JsUtil from 'tsx/common/JsUtil'\r\nimport cnst from 'tsx/common/Constant'\r\nimport BrView from 'tsx/view/BrView'\r\nimport ComponentView from 'tsx/view/ComponentView'\r\nimport SelectInput from 'tsx/form/SelectInput'\r\n\r\nclass RegionField3 extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\r\n\t\tthis.state = {\r\n\t\t\tprovinceId: 0,\r\n\t\t\tcityId: 0,\r\n\t\t\tcountyId: 0,\r\n\t\t\ttownId: 0,\r\n\t\t\tvillageId: 0,\r\n\t\t\tprovinceOptions: [],\r\n\t\t\tcityOptions: [],\r\n\t\t\tcountyOptions: [],\r\n\t\t\ttownOptions: [],\r\n\t\t\tvillageOptions: [],\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\t\tconst param = {\r\n\t\t\t\tparentId: cnst.ID_TOP_REGION\r\n\t\t\t}\r\n\r\n\t\t\tconst succ = (result) => {\r\n\t\t\t\tif (JsUtil.handleMessage(this, result)) {\r\n\t\t\t\t\tthis.setState({ provinceOptions: result.body });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst err = (result) => {\r\n\t\t\t\tJsUtil.handleMessage(this, result, true)\r\n\t\t\t}\r\n\r\n\t\t\tJsUtil.asyncHttpPost(this, '/lg/pub/region/search', JSON.stringify(param), succ, err);\r\n\t\t}\r\n\r\n\tprovinceChanged = (item) => {\r\n\t\tconst parentId = item.id;\r\n\t\tthis.onValueChange(parentId);\r\n\r\n\t\tlet params = {\r\n\t\t\tparentId: parentId\r\n\t\t}\r\n\r\n\t\tconst succ = (result) => {\r\n\t\t\tthis.setState({ provinceId: parentId, cityOptions: result.body, countyOptions: [], townOptions: [], villageOptions: [] });\r\n\t\t}\r\n\r\n\t\tconst err = (result) => {\r\n\t\t\tJsUtil.handleMessage(this, result, true)\r\n\t\t}\r\n\r\n\t\tJsUtil.asyncHttpPost(this,\r\n\t\t\t'/lg/pub/region/search',\r\n\t\t\tJSON.stringify(params),\r\n\t\t\tsucc,\r\n\t\t\terr\r\n\t\t);\r\n\t}\r\n\r\n\tcityChanged = (item) => {\r\n    \t\tconst parentId = item.id;\r\n    \t\tthis.onValueChange(parentId);\r\n    \t\t\r\n            const params = {\r\n                    parentId: parentId\r\n             }\r\n\r\n            const succ = (result) => {\r\n                this.setState({ cityId: parentId, countyOptions: result.body, townOptions: [], villageOptions: [] });\r\n            }\r\n\r\n            const err = (result) => {\r\n                JsUtil.handleMessage(this, result, true)\r\n            }\r\n\r\n            JsUtil.asyncHttpPost(this, '/lg/pub/region/search', JSON.stringify(params), succ, err);\r\n\t}\r\n\r\n\tcountyChanged = (item) => {\r\n\t\tconst parentId = item.id;\r\n\t\tthis.onValueChange(parentId);\r\n\r\n        this.setState({ countyId: parentId});\r\n\t}\r\n\t\r\n\tonValueChange = (value) => {\r\n\t\tthis.props.that.setState({regionId: value});\r\n\t}\t\r\n\r\n\trender() {\r\n\t\tconst mode = this.props.mode;\r\n\t\tconst { provinceOptions, cityOptions, countyOptions } = this.state;\r\n\t\tconst { provinceId, cityId, countyId } = this.state;\r\n\t\tconst labelKey = 'regionFullName';\r\n\t\tconst valueKey = 'id';\r\n        const labelWidth = this.props.labelWidth;\r\n        const valueWidth = this.props.valueWidth; \r\n\t\tlet disabled = false;\r\n\t\tif (mode == cnst.SHOW_MODE_VIEW) disabled = true;\r\n\r\n\t\treturn (\r\n\t\t\t<ComponentView justifyContent={this.props.justifyContent} alignItems={this.props.alignItems}>\r\n\t\t\t\t{provinceOptions &&\r\n\t\t\t\t\t<SelectInput options={provinceOptions} labelKey={labelKey} valueKey={valueKey} value={provinceId} onChange={this.provinceChanged} label={'省(市)'} disabled={disabled}  labelWidth={labelWidth} valueWidth={valueWidth}>\r\n\t\t\t\t\t</SelectInput>\r\n\t\t\t\t}\r\n                {provinceOptions &&\r\n                <BrView height={cnst.NUM_HEIGHT_LINE} backgroundColor={cnst.COLOR_BACKGROUND_WHITE} />\r\n                }\r\n\t\t\t\t\r\n                {cityOptions &&\r\n\t\t\t\t<SelectInput options={cityOptions} labelKey={labelKey} valueKey={valueKey} value={cityId} onChange={this.cityChanged} label={'市(州)'}  disabled={disabled}  labelWidth={labelWidth} valueWidth={valueWidth}>\r\n\t\t\t\t</SelectInput>\r\n                }\r\n                {cityOptions &&\r\n                <BrView height={cnst.NUM_HEIGHT_LINE} backgroundColor={cnst.COLOR_BACKGROUND_WHITE} />\r\n                }\r\n                \r\n\t\t\t\t{countyOptions &&\r\n\t\t\t\t\t<SelectInput options={countyOptions} labelKey={labelKey} valueKey={valueKey} value={countyId} onChange={this.countyChanged} label={'县(区)'} disabled={disabled}  labelWidth={labelWidth} valueWidth={valueWidth}>\r\n\t\t\t\t\t</SelectInput>\r\n\t\t\t\t}\r\n\t\t\t</ComponentView>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default RegionField3;\r\n","import React from \"react\";\r\nimport JsUtil from 'tsx/common/JsUtil'\r\nimport ComponentView from 'tsx/view/ComponentView'\r\nimport CascadeBox from 'tsx/form/CascadeBox'\r\n\r\nclass RegionTree extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\r\n\t\tthis.state = {\r\n\t\t\tdisplaySet: {}\r\n\t\t}\r\n\t}\r\n\r\n\tinitRegionNodes = [];\r\n\tcurrRegionNodes = [];\r\n\tlastParentId = '';\r\n\tprovinceCount = 10;\r\n    cityCount = 10;\r\n    countyCount=10000;\r\n\tcurrRegionPid;\r\n\t\r\n\tcomponentDidMount(){\r\n\t    this.fetchRegionData();\r\n\t}\r\n\t\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tconst { operatorId, regionId, freightDetails, currentFreightIdx, checkLevelAll } = this.props;\r\n\t\tif (operatorId && regionId && regionId != prevProps.regionId) {\r\n\t\t\tthis.initRegionNodes = JsUtil.getAppItem('freightOptions-' + regionId);\r\n\t\t\tif (!this.initRegionNodes) {\r\n\t\t\t\tthis.fetchRegionData();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (operatorId && regionId && currentFreightIdx>=0 && currentFreightIdx != prevProps.currentFreightIdx) {\r\n\t\t\tthis.initTree(freightDetails, currentFreightIdx);\r\n\t\t}\r\n\r\n\t\tif (this.currRegionPid && checkLevelAll != prevProps.checkLevelAll) {\r\n\t\t\tconst treeObj = this.currRegionNodes;\r\n\t\t\tconst nodes = treeObj.filter(e => e.pid == this.currRegionPid);\r\n\t\t\tconst displaySet = this.state.displaySet;\r\n\t\t\tif (nodes.length > 0) {\r\n\t\t\t\tnodes.forEach((item, i) => {\r\n\t\t\t\t\tif (checkLevelAll) {\r\n\t\t\t\t\t\titem.checked = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.checked = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tdisplaySet[this.currRegionPid] = true;\r\n\t\t\t\tthis.setState({ displaySet: displaySet })\r\n\t\t\t\tthis.props.setNodes(treeObj);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tinitTree = (freightDetails, currentFreightIdx) => {\r\n\t\tif(currentFreightIdx<0) return;\r\n\t\t\r\n\t\tthis.currRegionNodes = [];\r\n\t\tconsole.log('RegionTree initRegionNodes length is: ' + this.initRegionNodes.length)\r\n\t\tthis.initRegionNodes.forEach((item, idx) => {\r\n\t\t\tthis.currRegionNodes.push({ id: item.id, pid: item.pid, recordLevel: item.recordLevel, name: item.name, checked: item.checked });\r\n\t\t});\r\n\t\tthis.setTreeNode4ExistChecked(freightDetails, currentFreightIdx);\r\n\t}\r\n\r\n\tsetTreeNode4ExistChecked = (freightDetails, currentFreightIdx) => {\r\n\t\tconst treeObj = this.currRegionNodes;\r\n\t\tconst currentDetail = freightDetails[currentFreightIdx];\r\n\t\tconst displaySet = {};\r\n\t\tlet node = null;\r\n\t\tfor (const region of currentDetail.freightDetailRegions) {\r\n\t\t\tnode = treeObj.find(e => e.id == region.regionId);\r\n\t\t\tif (node) {\r\n\t\t\t\tnode.checked = true;\r\n\t\t\t\tnode = treeObj.find(e => e.id == node.pid);\r\n\t\t\t\tif (node) displaySet[node.id] = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setState({ displaySet: displaySet });\r\n\t}\r\n\r\n\tfetchRegionData = () => {\r\n\t\tconst {operatorId, regionId, freightDetails, currentFreightIdx} = this.props;\r\n        this.initRegionNodes = JsUtil.getAppItem('freightOptions-' + regionId);\r\n        if(this.initRegionNodes) {\r\n          this.initTree(freightDetails, currentFreightIdx);\r\n          return;\r\n        }\r\n        \r\n        this.initRegionNodes = [];\r\n        this.props.finishInit(false);\r\n        \r\n\t\tconst succ3 = (result) => {\r\n\t\t\tconst records = result.body;\r\n\t\t\tif (this.provinceCount == 0){\r\n              this.cityCount = this.cityCount - 1;\r\n//              if (this.cityCount == 0){\r\n//                  if(this.countyCount==10000)\r\n//                      this.countyCount = records.length;\r\n//                  this.countyCount = this.countyCount - 1;  \r\n//              }\r\n\t    \t}\r\n\t\t\trecords.forEach((item, i) => {\r\n\t\t\t\tthis.initRegionNodes.push({ id: item.id, pid: item.parentId, recordLevel: item.recordLevel, name: item.regionFullName, checked: false });\r\n\t\t\t});\r\n\t\t\t\r\n            const count = this.cityCount;\r\n            console.log('RegionTree cityCount:' + count)\r\n\t\t\tif (count == 0) {\r\n\t\t\t\tthis.props.finishInit(true);\r\n\t\t\t\tif (records.length > 0) {\r\n\t                JsUtil.setAppItem('freightOptions-' + regionId, this.initRegionNodes);\r\n\t\t\t        this.initTree(freightDetails, currentFreightIdx);\r\n\t            }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst succ2 = (result) => {\r\n\t\t\tconst records = result.body;\r\n\t\t\tthis.provinceCount = this.provinceCount - 1;\r\n\t\t\tif (this.provinceCount == 0) {\r\n\t\t\t\tthis.cityCount=records.length;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trecords.forEach((item, i) => {\r\n\t\t\t\tthis.initRegionNodes.push({ id: item.id, pid: item.parentId, recordLevel: item.recordLevel, name: item.regionFullName, checked: false });\r\n\r\n\t\t\t\tlet param = {parentId: item.id}\r\n\r\n\t\t\t\tJsUtil.asyncHttpPost(this,\r\n\t\t\t\t\t\"/lg/pub/region/search\",\r\n\t\t\t\t\tJSON.stringify(param),\r\n\t\t\t\t\tsucc3,\r\n\t\t\t\t\terr3 => JsUtil.showMsgBox(this, err3)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst succ1 = result => {\r\n\t\t\tconst records = result.body;\r\n\t\t\tthis.provinceCount = records.length;\r\n\r\n\t\t\trecords.forEach((item, i) => {\r\n\t\t\t\tthis.initRegionNodes.push({ id: item.id, pid: item.parentId, recordLevel: item.recordLevel, name: item.regionFullName, checked: false });\r\n\r\n\t\t\t\tconst param = {parentId: item.id}\r\n\r\n\t\t\t\tJsUtil.asyncHttpPost(this,\r\n\t\t\t\t\t\"/lg/pub/region/search\",\r\n\t\t\t\t\tJSON.stringify(param), succ2,\r\n\t\t\t\t\terr2 => JsUtil.showMsgBox(this, err2)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tJsUtil.asyncHttpPost(this,\r\n\t\t\t\"/lg/pub/region/search\",\r\n\t\t\tJSON.stringify({parentId: regionId}),\r\n\t\t\tsucc1,\r\n\t\t\terr1 => JsUtil.showMsgBox(this, \"请求失败:\" + err1.message)\r\n\t\t);\r\n\t}\r\n\r\n\tonCascadeBoxChanged = (name, selectedValues, changedValue) => {\r\n\t\tconst regionId = this.props.regionId;\r\n\t\tconst treeObj = this.currRegionNodes;\r\n\t\tconst node = treeObj.find(e => e.id == changedValue);\r\n\t\tif (node) {\r\n\t\t\tlet children2Display = null;\r\n\t\t\tconst parentNode = treeObj.find(e => e.id == node.pid);\r\n\t\t\tif (parentNode)\r\n\t\t\t\tthis.currRegionPid = parentNode.id;\r\n\t\t\telse\r\n\t\t\t\tthis.currRegionPid = regionId;\r\n\r\n\t\t\tif (node.checked) {\r\n\t\t\t\tnode.checked = false;\r\n\t\t\t\tif (node.pid == regionId) {//点击第1级\r\n\t\t\t\t\t//该节点的所有子节点，如果当前没显示的，则显示，否则不显示\r\n\t\t\t\t\tchildren2Display = this.state.displaySet[node.id];\r\n\t\t\t\t\tif (children2Display) children2Display = false;\r\n\t\t\t\t\telse children2Display = true;\r\n\t\t\t\t} else if (parentNode && parentNode.pid == regionId) {//点击第2级\r\n\t\t\t\t\t//该节点的所有子节点，如果当前没显示的，则显示，否则不显示\r\n\t\t\t\t\tchildren2Display = this.state.displaySet[node.id];\r\n\t\t\t\t\tif (children2Display) children2Display = false;\r\n\t\t\t\t\telse children2Display = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnode.checked = true;\r\n\r\n\t\t\t\tif (node.pid == regionId) {//点击第1级\r\n\t\t\t\t\tconst regions2 = treeObj.filter(e => e.pid == node.id);\r\n\t\t\t\t\tregions2.forEach((item2, idx2) => {\r\n\t\t\t\t\t\t//第2级不能选中\r\n\t\t\t\t\t\titem2.checked = false;\r\n\r\n\t\t\t\t\t\t//第3级不能选中\r\n\t\t\t\t\t\tconst regions3 = treeObj.filter(e => e.pid == item2.id);\r\n\t\t\t\t\t\tregions3.forEach((item3, idx3) => {\r\n\t\t\t\t\t\t\titem3.checked = false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\t//该节点的所有子节点，如果当前没显示的，则显示，否则不显示\r\n\t\t\t\t\tchildren2Display = this.state.displaySet[node.id];\r\n\t\t\t\t\tif (children2Display) children2Display = false;\r\n\t\t\t\t\telse children2Display = true;\r\n\t\t\t\t} else if (parentNode && parentNode.pid == regionId) {//点击第2级\r\n\t\t\t\t\t//第1级不能选中\r\n\t\t\t\t\tparentNode.checked = false;\r\n\r\n\t\t\t\t\t//第3级不能选中\r\n\t\t\t\t\tconst regions3 = treeObj.filter(e => e.pid == node.id);\r\n\t\t\t\t\tregions3.forEach((item3, idx3) => {\r\n\t\t\t\t\t\titem3.checked = false;\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\t//该节点的所有子节点，如果当前没显示的，则显示，否则不显示\r\n\t\t\t\t\tchildren2Display = this.state.displaySet[node.id];\r\n\t\t\t\t\tif (children2Display) children2Display = false;\r\n\t\t\t\t\telse children2Display = true;\r\n\t\t\t\t} else if (parentNode && parentNode.pid != regionId) {//点击第3级\r\n\t\t\t\t\t//第2级不能选中\r\n\t\t\t\t\tparentNode.checked = false;\r\n\t\t\t\t\t//第1级不能选中\r\n\t\t\t\t\tconst topNode = treeObj.find(e => e.id == parentNode.pid);\r\n\t\t\t\t\tif (topNode)\r\n\t\t\t\t\t\ttopNode.checked = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst displaySet = this.state.displaySet;\r\n\t\t\tdisplaySet[node.id] = children2Display;\r\n\t\t\tthis.setState({ displaySet: displaySet })\r\n\r\n\t\t\tthis.props.setNodes(treeObj);\r\n\t\t}\r\n\t}\r\n\r\n\tgetRegionOptions = () => {\r\n\t\tconst options = [];\r\n\t\tconst checkedList = [];\r\n\t\tconst regionId = this.props.regionId;\r\n\t\tif (!regionId) return { options, checkedList }\r\n\r\n\t\tconst treeObj = this.currRegionNodes;\r\n\t\tconsole.log('RegionTree currRegionNodes length is: ' + treeObj.length)\r\n\t\tconst regions1 = treeObj.filter(e => e.pid == regionId);\r\n\r\n\t\tlet desc = null;\r\n\t\tlet children2Display = null;\r\n\t\tlet desc2 = null;\r\n\t\tlet children2Display2 = null;\r\n\r\n\t\tregions1.map((item1, indx1) => {\r\n\t\t\tdesc = null;\r\n\t\t\tconst options2 = [];\r\n\t\t\tconst checkedList2 = [];\r\n\t\t\tif (item1.checked) checkedList.push(item1.id);\r\n\r\n\t\t\tchildren2Display = this.state.displaySet[item1.id];\r\n\t\t\tif (children2Display) {\r\n\t\t\t\tconst regions2 = treeObj.filter(e => e.pid == item1.id);\r\n\t\t\t\tregions2.map((item2, indx2) => {\r\n\t\t\t\t\tdesc2 = null;\r\n\t\t\t\t\tconst options3 = [];\r\n\t\t\t\t\tconst checkedList3 = [];\r\n\t\t\t\t\tif (item2.checked) checkedList2.push(item2.id);\r\n\r\n\t\t\t\t\tchildren2Display2 = this.state.displaySet[item2.id];\r\n\t\t\t\t\tif (children2Display2) {\r\n\t\t\t\t\t\tconst regions3 = treeObj.filter(e => e.pid == item2.id);//显示该节点的所有子节点\r\n\t\t\t\t\t\tregions3.map((item3, indx3) => {\r\n\t\t\t\t\t\t\tif (item3.checked) checkedList3.push(item3.id);\r\n\t\t\t\t\t\t\toptions3.push({ value: item3.id, label: item3.name, desc: '' });\r\n\t\t\t\t\t\t});//遍历第3级\r\n\r\n\t\t\t\t\t\tdesc2 = (\r\n\t\t\t\t\t\t\t<CascadeBox name='checkedList'  key={item2.id}\r\n\t\t\t\t\t\t\t\toptions={options3}\r\n\t\t\t\t\t\t\t\tvalue={checkedList3}\r\n\t\t\t\t\t\t        idxp={indx2}\r\n\t\t\t\t\t\t\t\tonChange={this.onCascadeBoxChanged}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t</CascadeBox>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toptions2.push({value: item2.id, label: item2.name, desc: desc2});\r\n\r\n\t\t\t\t});//遍历第2级\r\n\r\n\t\t\t\tdesc = (\r\n\t\t\t\t\t<CascadeBox name='checkedList'  key={item1.id}\r\n\t\t\t\t\t\toptions={options2}\r\n\t\t\t\t\t\tvalue={checkedList2}\r\n\t\t\t\t        idxp={indx1}\r\n\t\t\t\t\t\tonChange={this.onCascadeBoxChanged}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t</CascadeBox>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\toptions.push({ value: item1.id, label: item1.name, desc: desc })\r\n\t\t});//遍历第1级\r\n\r\n\t\treturn { options, checkedList }\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { options, checkedList } = this.getRegionOptions();\r\n\r\n\t\treturn (\r\n\t\t\t<ComponentView>\r\n\t\t\t\t<CascadeBox name='checkedList'  options={options} value={checkedList} onChange={this.onCascadeBoxChanged} />\r\n\t\t\t</ComponentView>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default RegionTree","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pkglogistics/page/logistics/FreightTemplateEntity!./FreightTemplateEntity.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pkglogistics/page/logistics/FreightTemplateEntity', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}